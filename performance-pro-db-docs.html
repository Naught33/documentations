<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Functions Usage Documentation</title>
    <link rel="stylesheet" href="database-docs.css">
</head>
<body>
    <header>
        <h1>Database Functions Usage Documentation</h1>
        <p class="subtitle">Complete guide to using the database operations in db.ts</p>
    </header>

    <nav class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#setup">Setup</a></li>
            <li><a href="#general">General Patterns</a></li>
            <li><a href="#users">User Operations</a></li>
            <li><a href="#ads">Ad Operations</a></li>
            <li><a href="#metrics">Metrics Operations</a></li>
            <li><a href="#notes">Note Operations</a></li>
            <li><a href="#subscriptions">Subscription Operations</a></li>
            <li><a href="#alerts">Alert Operations</a></li>
            <li><a href="#ai">AI Analysis Operations</a></li>
            <li><a href="#abtests">A/B Test Operations</a></li>
            <li><a href="#abvariants">A/B Test Variant Operations</a></li>
            <li><a href="#error-handling">Error Handling</a></li>
            <li><a href="#types">Type Definitions</a></li>
        </ul>
    </nav>

    <main>
        <section id="setup">
            <h2>Setup</h2>
            <div class="requirements">
                <p>Before using any database functions, ensure these environment variables are configured:</p>
                <div class="code-block">
                    <code>SUPABASE_PROJECT_ID="your-supabase-project-url"</code><br>
                    <code>SUPABASE_API_KEY="your-supabase-anon-key"</code>
                </div>
                <p>The database client is automatically initialized when importing from db.ts:</p>
                <div class="code-block">
                    <code>import { insertUser, getAd, updateMetrics } from './db';</code>
                </div>
            </div>
        </section>

        <section id="general">
            <h2>General Patterns</h2>
            <p>All database functions follow these consistent patterns:</p>
            
            <div class="pattern-grid">
                <div class="pattern-card">
                    <h3>Insert Functions</h3>
                    <p>Create new records with complete objects</p>
                    <div class="code-block">
                        <code>insertX(item: Type): Promise&lt;void&gt;</code>
                    </div>
                    <p>Example:</p>
                    <div class="code-block">
                        <code>await insertUser({ _id: '123', ... });</code>
                    </div>
                </div>

                <div class="pattern-card">
                    <h3>Update Functions</h3>
                    <p>Modify specific fields of existing records</p>
                    <div class="code-block">
                        <code>updateX(id: string, field: string, value: any): Promise&lt;any&gt;</code>
                    </div>
                    <p>Example:</p>
                    <div class="code-block">
                        <code>await updateUser('123', 'email', 'new@email.com');</code>
                    </div>
                </div>

                <div class="pattern-card">
                    <h3>Delete Functions</h3>
                    <p>Remove records by their ID</p>
                    <div class="code-block">
                        <code>deleteX(id: string): Promise&lt;void&gt;</code>
                    </div>
                    <p>Example:</p>
                    <div class="code-block">
                        <code>await deleteUser('123');</code>
                    </div>
                </div>

                <div class="pattern-card">
                    <h3>Get Functions</h3>
                    <p>Retrieve records with optional pagination</p>
                    <div class="code-block">
                        <code>getX(id: string): Promise&lt;Type&gt;</code><br>
                        <code>getXs(start?: number, end?: number): Promise&lt;Type[]&gt;</code>
                    </div>
                    <p>Example:</p>
                    <div class="code-block">
                        <code>const user = await getUser('123');</code><br>
                        <code>const users = await getUsers(0, 10);</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- User Operations Section -->
        <section id="users">
            <h2>User Operations</h2>
            <p class="type-reference">Type: <code>User</code> (see <a href="#types">Type Definitions</a>)</p>
            
            <div class="function-doc">
                <h3 class="function-signature">insertUser(user: User): Promise&lt;void&gt;</h3>
                <p>Creates a new user record.</p>
                <div class="example">
                    <h4>Example</h4>
                    <div class="code-block">
                        const newUser: User = {<br>
                        &nbsp;&nbsp;_id: 'user_123',<br>
                        &nbsp;&nbsp;email: 'user@example.com',<br>
                        &nbsp;&nbsp;role: 'admin',<br>
                        &nbsp;&nbsp;supabaseid: 'supa_456',<br>
                        &nbsp;&nbsp;subscriptionplane: 'premium',<br>
                        &nbsp;&nbsp;createdat: new Date()<br>
                        };<br><br>
                        
                        await insertUser(newUser);
                    </div>
                </div>
            </div>

            <div class="function-doc">
                <h3 class="function-signature">updateUser(id: string, field: string, value: any): Promise&lt;any&gt;</h3>
                <p>Updates a specific field of a user record. Cannot update the _id field.</p>
                <div class="example">
                    <h4>Example</h4>
                    <div class="code-block">
                        // Update user's email<br>
                        await updateUser('user_123', 'email', 'new@example.com');<br><br>
                        
                        // This will throw an error:<br>
                        // await updateUser('user_123', '_id', 'new_id');
                    </div>
                </div>
            </div>

            <div class="function-doc">
                <h3 class="function-signature">deleteUser(userId: string): Promise&lt;void&gt;</h3>
                <p>Permanently deletes a user record.</p>
                <div class="example">
                    <h4>Example</h4>
                    <div class="code-block">
                        await deleteUser('user_123');
                    </div>
                </div>
            </div>

            <div class="function-doc">
                <h3 class="function-signature">getUser(userId: string): Promise&lt;User&gt;</h3>
                <p>Retrieves a single user by ID.</p>
                <div class="example">
                    <h4>Example</h4>
                    <div class="code-block">
                        const user = await getUser('user_123');<br>
                        console.log(user.email); // 'user@example.com'
                    </div>
                </div>
            </div>

            <div class="function-doc">
                <h3 class="function-signature">getUsers(startPage?: number, endPage?: number): Promise&lt;User[]&gt;</h3>
                <p>Retrieves multiple users with optional pagination.</p>
                <div class="example">
                    <h4>Examples</h4>
                    <div class="code-block">
                        // Get all users<br>
                        const allUsers = await getUsers();<br><br>
                        
                        // Get users 10-20 (pagination)<br>
                        const pageOfUsers = await getUsers(10, 20);<br><br>
                        
                        // Invalid range throws error:<br>
                        // await getUsers(20, 10); // Error: start page > end page
                    </div>
                </div>
            </div>
        </section>

        <!-- Continue with other sections (Ads, Metrics, etc.) following the same pattern -->

        <section id="error-handling">
            <h2>Error Handling</h2>
            <p>All database functions throw errors in these cases:</p>
            <ul class="error-cases">
                <li>Missing or invalid parameters</li>
                <li>Attempting to modify protected fields (like _id)</li>
                <li>Database connection issues</li>
                <li>Invalid pagination ranges</li>
                <li>Record not found (for get/update/delete operations)</li>
            </ul>
            
            <div class="best-practice">
                <h3>Recommended Usage Pattern</h3>
                <div class="code-block">
                    try {<br>
                    &nbsp;&nbsp;const user = await getUser('user_123');<br>
                    &nbsp;&nbsp;await updateUser(user._id, 'email', 'updated@email.com');<br>
                    } catch (error) {<br>
                    &nbsp;&nbsp;console.error('Database operation failed:', error.message);<br>
                    &nbsp;&nbsp;// Handle specific error types if needed<br>
                    &nbsp;&nbsp;if (error.message.includes('not found')) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;// Handle missing record case<br>
                    &nbsp;&nbsp;}<br>
                    }
                </div>
            </div>
        </section>

        <section id="types">
            <h2>Type Definitions</h2>
            <p>All database operations use these TypeScript types from <code>dbTypes.ts</code>:</p>
            
            <div class="type-definition">
                <h3>User</h3>
                <div class="code-block">
                    type User = {<br>
                    &nbsp;&nbsp;_id: string,<br>
                    &nbsp;&nbsp;email: string,<br>
                    &nbsp;&nbsp;role: string,<br>
                    &nbsp;&nbsp;supabaseid: string,<br>
                    &nbsp;&nbsp;subscriptionplane: string,<br>
                    &nbsp;&nbsp;createdat: Date<br>
                    };
                </div>
            </div>

            <!-- Include all other type definitions similarly -->
            
            <div class="type-definition">
                <h3>ABTestVariant</h3>
                <div class="code-block">
                    type ABTestVariant = {<br>
                    &nbsp;&nbsp;_id: string,<br>
                    &nbsp;&nbsp;abtestid: string,<br>
                    &nbsp;&nbsp;adid: string,<br>
                    &nbsp;&nbsp;variantname: string<br>
                    };
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Database API Documentation | Generated from db.ts | Last updated: <span id="update-date"></span></p>
    </footer>

    <script>
        document.getElementById('update-date').textContent = new Date().toLocaleDateString();
    </script>
</body>
</html>
